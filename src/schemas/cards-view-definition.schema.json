{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "http://primebrick-sdk/cards-view-definition.schema.json",
    "title": "CardsViewDefinition",
    "description": "The cards view definition model",
    "type": "object",
    "properties": {
        "showArchivedEntities": {
            "description": "Flag to change how archived record are retrieved",
            "type": "string",
            "enum": ["none", "only", "also"],
            "default": "none"
        },
        "fields": {
            "description": "List of fields to show",
            "minItems": 1,
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {
                        "description": "Field name",
                        "type": "string",
                        "minLength": 3
                    },
                    "labelKey": {
                        "description": "Field label translatable key",
                        "type": "string",
                        "minLength": 3
                    },
                    "perms": {
                        "description": "List of permission needed to access to this field",
                        "type": "array",
                        "minItems": 1,
                        "items": {
                            "type": "string"
                        }
                    },
                    "type": {
                        "description": "Field type",
                        "type": "string",
                        "enum": ["string", "number", "boolean"],
                        "default": "string"
                    },
                    "isArchiveFlag": {
                        "description": "True to set field as 'archive' flag. A truly value on this entity field means that records is archived.",
                        "type": "boolean",
                        "default": false
                    },
                    "layout": {
                        "description": "Card layout where place the field",
                        "type": "object",
                        "properties": {
                            "isTitle": {
                                "description": "True if field must be placed as title (its label will not be printed)",
                                "type": "boolean",
                                "default": false
                            },
                            "isSubTitle": {
                                "description": "True if field must be placed as sub title (its label will not be printed)",
                                "type": "boolean",
                                "default": false
                            },
                            "line": {
                                "description": "Line number name. All field with same line number will be placed on same row.",
                                "type": "number"
                            },
                            "filling": {
                                "description": "Horizontal positions to fill",
                                "type": "array",
                                "minItems": 1,
                                "items": {
                                    "type": "string",
                                    "enum": ["left", "middle", "right"],
                                    "default": "left"
                                }
                            },
                            "align": {
                                "description": "Horizontal text alignment. Also the label will be aligned",
                                "type": "string",
                                "enum": ["left", "center", "right"],
                                "default": "left"
                            },
                            "isChip": {
                                "description": "Draw value inside a chip and hide field label",
                                "type": "boolean",
                                "default": false
                            },
                            "hideLabel": {
                                "description": "Hide field label",
                                "type": "boolean",
                                "default": false
                            },
                            "isBold": {
                                "description": "Change font weigth to BOLD for field value",
                                "type": "boolean",
                                "default": false
                            },
                            "isDetail": {
                                "description": "True if field must be visible only when card show details",
                                "type": "boolean",
                                "default": false
                            }
                        },
                        "required": [],
                        "additionalProperties": false,
                        "anyOf": [
                            {
                                "if": {
                                    "properties": { "isSubTitle": { "const": false } }
                                },
                                "then": {
                                    "required": ["line", "filling"]
                                }
                            },
                            {
                                "if": {
                                    "properties": { "isTitle": { "const": false } }
                                },
                                "then": {
                                    "required": ["line", "filling"]
                                }
                            }
                        ]
                    },
                    "disableSort": {
                        "description": "True to disable column sort feature",
                        "type": "boolean",
                        "default": false
                    },
                    "disableGroup": {
                        "description": "True to disable column group feature",
                        "type": "boolean",
                        "default": false
                    }
                },
                "required": ["name"],
                "additionalProperties": false
            }
        },
        "filters": {
            "description": "List of filters to apply",
            "minItems": 1,
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "leftOperator": {
                        "description": "Logical operator AND/OR before the expression block",
                        "type": "string",
                        "enum": ["AND", "OR"],
                        "default": "AND"
                    },
                    "expressionOperator": {
                        "description": "Logical operator AND/OR between expression values",
                        "type": "string",
                        "enum": ["AND", "OR"],
                        "default": "AND"
                    },
                    "expressions": {
                        "description": "Array of conditions to apply",
                        "type": "array",
                        "minItems": 1,
                        "items": {
                            "type": "string"
                        }
                    },
                    "expressionValues": {
                        "description": "Object with parametrized values",
                        "examples": ["{valueAlias: value}"],
                        "type": "object"
                    }
                },
                "required": ["expressions"],
                "additionalProperties": false
            }
        },
        "sorts": {
            "description": "List of sort conditions to apply",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "properties": {
                    "field": {
                        "description": "Field name to sort with",
                        "type": "string"
                    },
                    "direction": {
                        "description": "Direction to sort with",
                        "type": "string",
                        "enum": ["ASC", "DESC"],
                        "default": "ASC"
                    }
                },
                "required": ["field"],
                "additionalProperties": false
            }
        },
        "perms": {
            "description": "List of permission needed to access to this view",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "string"
            }
        },
        "options": {
            "description": "View options",
            "type": "object",
            "properties": {
                "enableMultiSelect": {
                    "description": "Allow selection of many rows",
                    "type": "boolean",
                    "default": false
                },
                "itemsPerPage": {
                    "description": "Number of items to retrieve per page",
                    "type": "number",
                    "default": 20
                },
                "enableRecordNameAsTitle": {
                    "description": "Allow record name to be show as title",
                    "type": "boolean",
                    "default": false
                },
                "enableRecordNameAsSubTitle": {
                    "description": "Allow record name to be show as title",
                    "type": "boolean",
                    "default": false
                }
            },
            "additionalProperties": false
        },
        "actions": {
            "description": "List of configurable actions",
            "type": "object",
            "properties": {
                "open": {
                    "description": "[ Open ] action configuration",
                    "type": "object",
                    "properties": {
                        "view": {
                            "description": "View to show",
                            "type": "string"
                        },
                        "enableDoubleClick": {
                            "description": "Show view on double click",
                            "type": "boolean",
                            "default": false
                        },
                        "enableItemButton": {
                            "description": "Show button on card",
                            "type": "boolean",
                            "default": false
                        },
                        "enableTitleLink": {
                            "description": "Show link on card title",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "edit": {
                    "description": "[ Edit ] action configuration",
                    "type": "object",
                    "properties": {
                        "view": {
                            "description": "View to show",
                            "type": "string"
                        },
                        "enableDoubleClick": {
                            "description": "Show view on double click",
                            "type": "boolean",
                            "default": false
                        },
                        "enableItemButton": {
                            "description": "Show button on card",
                            "type": "boolean",
                            "default": false
                        },
                        "enableTitleLink": {
                            "description": "Show link on card title",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "add": {
                    "description": "[ Add ] action configuration",
                    "type": "object",
                    "properties": {
                        "view": {
                            "description": "View to show",
                            "type": "string"
                        },
                        "enableToolbarButton": {
                            "description": "Show button in toolbar",
                            "type": "boolean",
                            "default": false
                        },
                        "enableFloatingButton": {
                            "description": "Show floating action button",
                            "type": "boolean",
                            "default": false
                        },
                        "enableMenuLink": {
                            "description": "Show link in menu",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "delete": {
                    "description": "[ Delete ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableToolbarButton": {
                            "description": "Show button in toolbar",
                            "type": "boolean",
                            "default": false
                        },
                        "enableMenuLink": {
                            "description": "Show link in menu",
                            "type": "boolean",
                            "default": false
                        },
                        "enableItemButton": {
                            "description": "Show button on card",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "archive": {
                    "description": "[ Archive ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableToolbarButton": {
                            "description": "Show button in toolbar",
                            "type": "boolean",
                            "default": false
                        },
                        "enableMenuLink": {
                            "description": "Show link in menu",
                            "type": "boolean",
                            "default": false
                        },
                        "enableItemButton": {
                            "description": "Show button on card",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "refresh": {
                    "description": "[ Refresh ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableToolbarButton": {
                            "description": "Show button in toolbar",
                            "type": "boolean",
                            "default": false
                        },
                        "enableMenuLink": {
                            "description": "Show link in menu",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "archivedFilter": {
                    "description": "[ Show Archived ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableToolbarButton": {
                            "description": "Show dropdown in toolbar",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "restore": {
                    "description": "[ Restore ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableToolbarButton": {
                            "description": "Show button in toolbar",
                            "type": "boolean",
                            "default": false
                        },
                        "enableMenuLink": {
                            "description": "Show link in menu",
                            "type": "boolean",
                            "default": false
                        },
                        "enableItemButton": {
                            "description": "Show button on card",
                            "type": "boolean",
                            "default": false
                        }
                    },
                    "additionalProperties": false
                },
                "search": {
                    "description": "[ Search ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableToolbarButton": {
                            "description": "Show search box in toolbar",
                            "type": "boolean",
                            "default": false
                        },
                        "fields": {
                            "description": "List fields to looking for",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "string"
                            }
                        }
                    },
                    "additionalProperties": false,
                    "if": {
                        "properties": { "enableToolbarButton": { "const": true } }
                    },
                    "then": {
                        "required": ["fields"]
                    }
                },
                "filter": {
                    "description": "[ Filter ] action configuration",
                    "type": "object",
                    "properties": {
                        "enableHeader": {
                            "description": "Show filter field under header",
                            "type": "boolean",
                            "default": false
                        },
                        "enableDialog": {
                            "description": "Show filters in a modal dialog",
                            "type": "boolean",
                            "default": false
                        },
                        "fields": {
                            "description": "List fields to allow filter",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                                "type": "object",
                                "properties": {
                                    "field": {
                                        "description": "Field name to allow filter",
                                        "type": "string"
                                    },
                                    "type": {
                                        "description": "Type of filter",
                                        "type": "string",
                                        "enum": ["string", "list", "search"],
                                        "default": "string"
                                    },
                                    "listOptions": {
                                        "description": "List options to configure dropdown filter component",
                                        "type": "object",
                                        "properties": {
                                            "enableMultiSelection": {
                                                "description": "True to allow selection of more than one dropdown item",
                                                "type": "boolean",
                                                "default": false
                                            },
                                            "values": {
                                                "description": "A set of pre-defined items to populate dropdown",
                                                "type": "array",
                                                "minItems": 1,
                                                "items": {
                                                    "type": "object",
                                                    "properties": {
                                                        "labelKey": {
                                                            "description": "Item label translatable key",
                                                            "type": "string"
                                                        },
                                                        "value": {
                                                            "description": "Item value",
                                                            "type": ["string", "number"]
                                                        }
                                                    },
                                                    "required": ["labelKey", "value"],
                                                    "additionalProperties": false
                                                }
                                            },
                                            "query": {
                                                "description": "Query to retrieve items to populate dropdown",
                                                "type": "object",
                                                "properties": {
                                                    "brick": {
                                                        "description": "Brick name",
                                                        "type": "string"
                                                    },
                                                    "entity": {
                                                        "description": "Entity name",
                                                        "type": "string"
                                                    },
                                                    "textFieldName": {
                                                        "description": "Field name for text (not translatable) dropdown item",
                                                        "type": "string"
                                                    },
                                                    "valueFieldName": {
                                                        "description": "Field name for value dropdown item",
                                                        "type": "string"
                                                    },
                                                    "labelKeyFieldName": {
                                                        "description": "Field name for labelKey (translatable) dropdown item",
                                                        "type": "string"
                                                    },
                                                    "searchFields": {
                                                        "description": "List of fields where apply search term",
                                                        "type": "array",
                                                        "minItems": 1,
                                                        "items": {
                                                            "type": "string"
                                                        }
                                                    },
                                                    "showArchivedEntities": {
                                                        "description": "Flag to change how archived record are retrieved",
                                                        "type": "string",
                                                        "enum": ["none", "only", "also"],
                                                        "default": "none"
                                                    },
                                                    "filters": {
                                                        "description": "List of filters to apply",
                                                        "minItems": 1,
                                                        "type": "array",
                                                        "items": {
                                                            "type": "object",
                                                            "properties": {
                                                                "leftOperator": {
                                                                    "description": "Logical operator AND/OR before the expression block",
                                                                    "type": "string",
                                                                    "enum": ["AND", "OR"],
                                                                    "default": "AND"
                                                                },
                                                                "expressionOperator": {
                                                                    "description": "Logical operator AND/OR between expression values",
                                                                    "type": "string",
                                                                    "enum": ["AND", "OR"],
                                                                    "default": "AND"
                                                                },
                                                                "expressions": {
                                                                    "description": "Array of conditions to apply",
                                                                    "type": "array",
                                                                    "minItems": 1,
                                                                    "items": {
                                                                        "type": "string"
                                                                    }
                                                                },
                                                                "expressionValues": {
                                                                    "description": "Object with parametrized values",
                                                                    "examples": ["{valueAlias: value}"],
                                                                    "type": "object"
                                                                }
                                                            },
                                                            "required": ["expressions"],
                                                            "additionalProperties": false
                                                        }
                                                    },
                                                    "sorts": {
                                                        "description": "List of sort conditions to apply",
                                                        "type": "array",
                                                        "minItems": 1,
                                                        "items": {
                                                            "type": "object",
                                                            "properties": {
                                                                "field": {
                                                                    "description": "Field name to sort with",
                                                                    "type": "string"
                                                                },
                                                                "direction": {
                                                                    "description": "Direction to sort with",
                                                                    "type": "string",
                                                                    "enum": ["ASC", "DESC"],
                                                                    "default": "ASC"
                                                                }
                                                            },
                                                            "required": ["field"],
                                                            "additionalProperties": false
                                                        }
                                                    }
                                                },
                                                "required": ["brick", "entity", "valueFieldName", "searchFields"],
                                                "additionalProperties": false,
                                                "oneOf": [
                                                    {
                                                        "required": ["textFieldName"],
                                                        "not": {
                                                            "required": ["labelKeyFieldName"]
                                                        }
                                                    },
                                                    {
                                                        "required": ["labelKeyFieldName"],
                                                        "not": {
                                                            "required": ["textFieldName"]
                                                        }
                                                    }
                                                ]
                                            }
                                        },
                                        "additionalProperties": false,
                                        "oneOf": [
                                            {
                                                "required": ["values"],
                                                "not": {
                                                    "required": ["query"]
                                                }
                                            },
                                            {
                                                "required": ["query"],
                                                "not": {
                                                    "required": ["values"]
                                                }
                                            }
                                        ]
                                    }
                                },
                                "required": ["field", "type"],
                                "additionalProperties": false,
                                "if": {
                                    "properties": { "type": { "const": "list" } }
                                },
                                "then": {
                                    "required": ["listOptions"]
                                }
                            }
                        }
                    },
                    "required": ["fields"],
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "highlighters": {
            "description": "List of highlight rules",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "properties": {
                    "expression": {
                        "description": "Conditional expression",
                        "type": "string"
                    },
                    "title": {
                        "description": "Title font settings",
                        "type": "object",
                        "properties": {
                            "color": {
                                "description": "Font color",
                                "type": "string"
                            },
                            "weight": {
                                "description": "Font weight",
                                "type": "string",
                                "enum": ["black", "bold", "medium", "regular", "light", "thin"],
                                "default": "regular"
                            },
                            "style": {
                                "description": "Font style",
                                "type": "string",
                                "enum": ["none", "line-through", "overline", "underline"],
                                "default": "none"
                            },
                            "italic": {
                                "description": "Font italic",
                                "type": "boolean",
                                "default": false
                            }
                        },
                        "additionalProperties": false
                    },
                    "border": {
                        "description": "Card borders settings",
                        "type": "object",
                        "properties": {
                            "sides": {
                                "description": "Side borders to fill ",
                                "type": "array",
                                "minItems": 1,
                                "items": {
                                    "type": "string",
                                    "enum": ["left", "top", "right", "bottom"],
                                    "default": "left"
                                }
                            },
                            "size": {
                                "description": "Border size in pixel",
                                "type": "number",
                                "default": 5
                            },
                            "color": {
                                "description": "Border color both HEX or NAMED",
                                "type": "string",
                                "examples": ["#607D8B", "success"],
                                "default": "#607D8B"
                            }
                        },
                        "required": ["sides"],
                        "additionalProperties": false
                    },
                    "icon": {
                        "description": "Card icon title settings",
                        "type": "object",
                        "properties": {
                            "name": {
                                "description": "Icon class name",
                                "type": "string",
                                "default": "mdi-card-text"
                            },
                            "color": {
                                "description": "Icon color name",
                                "type": "string",
                                "examples": ["success"],
                                "default": "success"
                            }
                        },
                        "required": ["name", "color"],
                        "additionalProperties": false
                    }
                },
                "required": ["expression"],
                "additionalProperties": false
            }
        },
        "alternativeViews": {
            "description": "List of alternative views",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "properties": {
                    "name": {
                        "description": "View name",
                        "type": "string"
                    },
                    "type": {
                        "description": "View type",
                        "type": "string",
                        "enum": ["grid", "cards"]
                    }
                },
                "required": ["name", "type"],
                "additionalProperties": false
            }
        },
        "aggregators": {
            "description": "List of aggregators",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "properties": {
                    "expression": {
                        "description": "Aggregation expression",
                        "type": "string",
                        "examples": ["SUM($self.{fieldname})"]
                    },
                    "filters": {
                        "description": "List of filters to apply",
                        "minItems": 1,
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "leftOperator": {
                                    "description": "Logical operator AND/OR before the expression block",
                                    "type": "string",
                                    "enum": ["AND", "OR"],
                                    "default": "AND"
                                },
                                "expressionOperator": {
                                    "description": "Logical operator AND/OR between expression values",
                                    "type": "string",
                                    "enum": ["AND", "OR"],
                                    "default": "AND"
                                },
                                "expressions": {
                                    "description": "Array of conditions to apply",
                                    "type": "array",
                                    "minItems": 1,
                                    "items": {
                                        "type": "string"
                                    }
                                },
                                "expressionValues": {
                                    "description": "Object with parametrized values",
                                    "examples": [{ "valueAlias": "value" }],
                                    "type": "object"
                                }
                            },
                            "required": ["expressions"],
                            "additionalProperties": false
                        }
                    },
                    "color": {
                        "description": "The color name for both font and border",
                        "type": "string",
                        "examples": ["tertiary", "success", "green"],
                        "default": "tertiary"
                    },
                    "labelKey": {
                        "description": "Label translatable key",
                        "type": "string"
                    },
                    "excludeUIFilters": {
                        "description": "Exclude all user filters",
                        "type": "boolean",
                        "default": false
                    }
                },
                "required": ["expression", "labelKey"],
                "additionalProperties": false
            }
        }
    },
    "required": ["fields"],
    "additionalProperties": false
}
